<nav class="navbar">
  <a routerLink="/" class="logo">Flight Booking Sys</a>

  <div class="nav-actions">
    <button type="button" class="signup" (click)="logout()">Logout</button>
  </div>
</nav>

<app-toast></app-toast>

<main class="auth-shell login-shell">
  <div class="auth-card login-card">
    <div class="auth-header">
      <p class="eyebrow accent">Security</p>
      <h1>{{ mode === 'change' ? 'Change password' : 'Forgot password' }}</h1>
      <p class="auth-subtitle spaced">
        {{ mode === 'change'
          ? 'Set a strong, unique password. Backend will validate and apply it.'
          : 'Request a reset code, then confirm with your new password.' }}
      </p>

      <div class="auth-footer" style="margin-top: 10px">
        <button class="ghost-btn" type="button" (click)="mode = 'change'" [disabled]="mode === 'change' || pending">
          Change password
        </button>
        <button class="ghost-btn" type="button" (click)="mode = 'forgot'" [disabled]="mode === 'forgot' || pending">
          Forgot password
        </button>
      </div>
    </div>

    <form
      *ngIf="mode === 'change'"
      class="auth-form"
      (ngSubmit)="submit(form)"
      #form="ngForm"
      novalidate>

      <div class="input-group">
        <label>Current password</label>
        <input
          type="password"
          name="current"
          [(ngModel)]="currentPassword"
          required />
      </div>

      <div class="input-group">
        <label>New password</label>
        <input
          type="password"
          name="newPassword"
          [(ngModel)]="newPassword"
          required />
        <p class="auth-note" *ngIf="passwordError()">
          {{ passwordError() }}
        </p>
      </div>

      <div class="input-group">
        <label>Confirm new password</label>
        <input
          type="password"
          name="confirmPassword"
          [(ngModel)]="confirmPassword"
          required />
        <p class="auth-note" *ngIf="confirmError()">
          {{ confirmError() }}
        </p>
      </div>

      <button
        type="submit"
        class="auth-btn login-btn"
        [class.submitting]="pending"
        [disabled]="pending || !canSubmit()">

        <span class="label">Update password</span>
        <span class="spinner" aria-hidden="true"></span>
      </button>

      <p class="auth-note" *ngIf="message">{{ message }}</p>
    </form>

    <form
      *ngIf="mode === 'forgot'"
      class="auth-form"
      (ngSubmit)="submitResetConfirm(resetConfirmForm)"
      #resetConfirmForm="ngForm"
      novalidate>

      <div class="input-group">
        <label>Username</label>
        <input
          type="text"
          name="resetUser"
          [(ngModel)]="resetUsername"
          required />
      </div>

      <div class="input-group">
        <label>Email</label>
        <input
          type="email"
          name="resetEmail"
          [(ngModel)]="resetEmail"
          required />
      </div>

      <button
        type="button"
        class="auth-btn login-btn"
        [class.submitting]="pending"
        [disabled]="pending || !resetUsername || !resetEmail"
        (click)="submitResetRequest(resetConfirmForm)">
        <span class="label">Request reset code</span>
        <span class="spinner" aria-hidden="true"></span>
      </button>

      <div class="input-group" *ngIf="resetRequested">
        <label>Reset code</label>
        <input
          type="text"
          name="resetCode"
          maxlength="6"
          [(ngModel)]="resetCode"
          required />
      </div>

      <div class="input-group" *ngIf="resetRequested">
        <label>New password</label>
        <input
          type="password"
          name="resetNewPassword"
          [(ngModel)]="resetNewPassword"
          required />
        <p class="auth-note" *ngIf="resetPasswordError()">
          {{ resetPasswordError() }}
        </p>
      </div>

      <div class="input-group" *ngIf="resetRequested">
        <label>Confirm new password</label>
        <input
          type="password"
          name="resetConfirmPassword"
          [(ngModel)]="resetConfirmPassword"
          required />
        <p class="auth-note" *ngIf="resetConfirmError()">
          {{ resetConfirmError() }}
        </p>
      </div>

      <button
        *ngIf="resetRequested"
        type="submit"
        class="auth-btn login-btn"
        [class.submitting]="pending"
        [disabled]="pending || !canSubmitResetConfirm()">
        <span class="label">Confirm reset</span>
        <span class="spinner" aria-hidden="true"></span>
      </button>
    </form>
  </div>
</main>
